# Template file for 'git-annex'
pkgname=git-annex
version=10.20250102
revision=1
build_style=gnu-makefile
make_use_env=yes
hostmakedepends="ghc cabal-install pkg-config"
makedepends="curl file-devel gnupg gnutls-devel gsasl-devel libxml2-devel
 lsof rsync git ncurses-devel bup borg nocache git-remote-gcrypt dbus-devel
 zlib-devel"
# depends are utilities required by git-annex
depends="git rsync curl lsof gnupg>=2"
short_desc="Git addon for managing large files"
maintainer="Orphaned <orphan@voidlinux.org>"
license="AGPL-3.0-or-later, MIT, BSD-2-Clause, GPL-3.0-or-later, custom:Expat, custom:MIT-twitter, GPL-2.0-only, custom:icon-license"
homepage="https://git-annex.branchable.com"
changelog="https://git.joeyh.name/index.cgi/git-annex.git/plain/CHANGELOG"
distfiles="https://git.joeyh.name/index.cgi/git-annex.git/snapshot/git-annex-${version}.tar.gz"
checksum=65ed59d25334891a054f000c3f668b2e31ff2fb48863cd3a9406a3a5d8206476
nopie_files="/usr/bin/git-annex"
nocross=yes

# https://github.com/yesodweb/yesod/issues/1854
export BUILDEROPTIONS="--constraint 'wai-extra<3.1.17'"

if [ "$XBPS_TARGET_WORDSIZE" = 32 ]; then
	broken="unsupported upstream"
fi

pre_build() {
	cabal update
	cabal install --lib filepath-bytestring exceptions async
}

post_install() {
	vlicense doc/license/AGPL
}
