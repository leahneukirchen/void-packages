# Template file for 'radicle'
pkgname=radicle
version=1.0.0
revision=1
build_style=cargo
make_build_args="--workspace"
hostmakedepends="git ruby-asciidoctor pkg-config"
makedepends="libgit2-1.8-devel"
depends="git"
short_desc="Peer-to-peer, local-first code collaboration stack built on Git"
maintainer="Leah Neukirchen <leah@vuxu.org>"
license="MIT, Apache-2.0"
homepage="https://radicle.xyz/"
_gitrepo="https://seed.radicle.xyz/z3gqcJUoA1n9HaHKufZs5FCSGazv5"
_gitrev="d39ba83cfc7c7685548d18652fef039e25b19276"

export RADICLE_VERSION=${version}

do_fetch() {
	rm -rf ${wrksrc}
	git clone ${_gitrepo} ${wrksrc}
	cd ${wrksrc}
	git fetch origin ${_gitrev}
	git checkout FETCH_HEAD
}

post_build() {
	scripts/build-man-pages.sh . *.adoc
}

do_check() {
	:
}

do_install() {
	for crate in radicle-cli radicle-node radicle-remote-helper; do
		cargo auditable install --target ${RUST_TARGET} \
			--root="${DESTDIR}/usr" --offline --locked \
			--path=${crate}
	done

	rm -f ${DESTDIR}/usr/.crates*

	for f in *.1; do
		vman $f
	done

	vlicense LICENSE-MIT
}
